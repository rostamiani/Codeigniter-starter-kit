{% extends '_base.twig' %}

{% set page_header = 'لیست بیمه نامه ها' %}
{% set page_header_icon = 'fa fa-file' %}

{% set top_buttons = 
	[
		{
			title: 'بیمه نامه جدید',
			link: base_url()~"bimename/add",
			type: 'primary',
			icon: 'fas fa-plus-square'
		},
	]
%}

{% block content %}
    <div class="card card-body shadow animated fadeInRight">
        <div class="row">
            <div class="col-lg-12">
                <div class="table-responsive">
                    <table id="table_users" class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th class="text-center"><input type="checkbox" class="chk_select_all"></th>
                                <th>شناسه</th>
                                <th>نام و نام خانوادگی</th>
                                <th>کد ملی</th>
                                <th>تاریخ تولد</th>
                                <th>شماره موبایل</th>	
                                <th>نوع بیمه</th>	
                                <th>شماره بیمه</th>	
                                <th>مورد بیمه</th>	
                                <th>مبلغ بیمه</th>	
                                <th>تاریخ شروع</th>	
                                <th>تاریخ پایان</th>	
                                <th>تعداد اقساط</th>	
                                <th>مبلغ هر قسط</th>	
                                <th>هرچند ماه یکبار</th>	
                                <th>فعال</th>	
                                <th>یادآوری</th>	
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in list %}
                            <tr>
                                <td class="text-center"><input type="checkbox" class="chk_select" data-user-id="{{item.id}}"></td>
                                <td class="field-id">{{item.id}}</td>
                                <td class="field-fullname">{{item.fullname}}</td>
                                <td class="field-codemelli">{{item.codemelli}}</td>
                                <td class="field-date_birth">{{item.date_birth}}</td>
                                <td class="field-mobile">{{item.mobile}}</td>
                                <td class="field-code">{{item.code}}</td>
                                <td class="field-comment">{{item.comment}}</td>
                                <td class="field-price">{{item.price}}</td>
                                <td class="field-date_start">{{item.date_start}}</td>
                                <td class="field-date_end">{{item.date_end}}</td>
                                <td class="field-ghest_count">{{item.ghest_count}}</td>
                                <td class="field-ghest_price">{{item.ghest_price}}</td>
                                <td class="field-ghest_amount">{{item.ghest_amount}}</td>
                                <td class="field-month_period">{{item.month_period}}</td>
                                <td class="field-enable_alert">{{item.enable_alert}}</td>
                                <td class="field-bimetype_id">{{item.bimetype_id}}</td>
								<td class="operations p-0">
									<a href="{{base_url()}}bimename/update/{{item.id}}" class="btn btn-primary btn-update"> ویرایش </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
	$(document).ready(function() {
		
		// Initialize datatable plugin
		table_users = $('#table_users').DataTable({
			// "processing": true,
			// "serverSide": true,
			// searchDelay: 1200,
			// 'ajax': '{{base_url()}}users/ajax_datatable_list',
        	language: {
				url: "{{base_url()}}assets/js/plugins/dataTables/Persian.json"
			},
		});
		
		// Change status on list change
		$('#table_users .list_status').change(function(){
			
			// Display loading animation
			$(this).addClass('loading bg-primary').prop('disabled',true);
			
			// Get status and user_id from list
			var user_id = $(this).data('user-id');
			var selected_status = $(this).find('option:selected').val();
			var this_select = this;
			
			// Send change request to server
			$.getJSON("{{base_url()}}user/ajax_set/"+user_id+"/status/"+selected_status)
			.done(function(data){
				// If success
				if(data.code == 0)
				{
					// Remove animation
					$(this_select).removeClass('loading bg-primary').prop('disabled',false);
				}
				else
				{
					// Remove animation
					$(this_select).removeClass('loading bg-primary').prop('disabled',false);
					
					// Show error message
					modal_message('خطا در ویرایش');
				}
			})
			// If connection failed
			.fail(function(){
				// Show error message
				modal_message('خطای ارتباط با سایت');
			})
		})
		
		// Deleting confirmation
		$('.btn-remove').click(function () {
			
			// Get hyperlink (href property is not used to prevent accedental deletes)
			var href = $(this).data('href');
			
			// Show confirmation modal
			username = $(this).closest('tr').find('td.field-username').text();
			modal_confirm('کاربر '+username+' حذف شود؟', function () {
				window.location = href;
			});
			
			// Prevent default behaviuor
			return false;
		})

		// Select, deselect all chekboxes if the header checkbox changed
		$('.chk_select_all').change(function(){
	
			// Check all checkboxes 
			$('.chk_select').prop('checked', $(this).is(':checked') );
		});

		// Check header checkbox if all checkboxes was selected
		$('.chk_select').change(function(){

			// If all are cheched, check header checkbox
			$('.chk_select_all').prop('checked', $('.chk_select').length == $('.chk_select:checked').length);
		});

	}); // Document Ready
</script>

{# {{dump()}} #}
{% endblock %}